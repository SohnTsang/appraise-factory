<%= render 'layouts/login_header' %>
<div class="d-flex align-items-center">
    <h1>お問合せ一覧</h1>

</div>
<table class="table table-bordered border-primary table-hover table-sm posts_table">
  <thead class="bg-info text-light">
    <tr>
      <th scope="col" style="width: 100px">類別</th>
      <% if current_user.admin? %>
        <th scope="col">お客様</th>
        <th scope="col">受信日</th>
      <% else %>
        <th scope="col">送信日</th>
      <% end %>
      <th scope="col">更新日時</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
      <% @posts.each do |post| %>
        <tr>
            <th><%= post.category %></th>
            <th><%= post.email %></th>
            <td><%= post.created_at.to_s(:datetime_base) %></td>
            <% if post.comments.exists? %>
              <td><%= post.comments.last.updated_at.to_s(:datetime_base)  %></td>
            <% else %>
              <td><%= post.created_at.to_s(:datetime_base)  %></td>
            <% end %>
              <td><%= link_to '詳細', post, id: "detail-" + post.id.to_s, class: 'btn btn-outline-info' %></td>
            <% if current_user.admin? %>
              <td><%= post.read ? '既読' : '未読' %></td>
              <td><%= post.reply ? '返信済み' : '未返信' %></td>
            <% else %>
              <% if post.comments.exists? && post.comments.last.user.email != current_user.email %>
                  <% if post.readforclients == false %>
                    <td class="text-center">返信がありました!</td>
                  <% end %>
              <% end %>
            <% end %>
        </tr>
      <% end %>
  </tbody>
</table>
